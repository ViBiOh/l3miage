apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: l3miage
  namespace: default
spec:
  interval: 120m
  chart:
    spec:
      chart: app
      version: '0.0.81'
      sourceRef:
        kind: HelmRepository
        name: vibioh
      interval: 120m
  install:
    crds: Skip
  maxHistory: 3
  upgrade:
    remediation:
      retries: 3
  rollback:
    cleanupOnFail: true
  values:
    nameOverride: l3miage
    image:
      name: vibioh/l3miage
      tag: '202206251639' # {"$imagepolicy": "default:flux-l3miage-web:tag"}
    config:
      VIWS_LOGGER_JSON: 'true'
      VIWS_PROMETHEUS_GZIP: 'false'
      VIWS_GZIP: 'false'
    secrets:
      ALGOLIA_APP: 'AgATa2LklZzVs9AnfTlSZY2HuMnG57/A28A/mX1wxyvMDqYuMidwc2ow4YlxjX/WAuav/fper0lKluihX3vDvPlM8wwm6OB1PiK/b1mJVXnPmDVNao2gBHOE3Hjlo5ovKe5zcddY5+mCJrFo4/wiiEtDKqZWsUs6CM84K6ce/OO/10nRgZquBB88akEaq0fiL9Nekk4jm7PBgncdJHGg5h7MfaWFqmIfUN9f6tI/Zea1piE1nBALAnIbgSqg51ott9TOaPR97aCODQzgXmWPPBaN42k3e2tSFcIPXAdLNI7Zi1b0nKe9LVg7xONTXiLbj4NYDE2/s8qPgwu9/+x7NJvP5+nDIkvBZcXNlNQizq1frBs308sBIHMrdomnKYVM7JHn2ApA0zHJfJKoArudNffi8ViGyqG3bVcrn7/TuYKI5KVBvtOytfdbPRk71P1zOUSibXWOwJoUBWGWLfNb8m4JhciRlfORltaDexhSrGwlojLo7xfgxMcepGXhWxWp9viLmt4qQIZC9gclpyL+BQiGSH3MRulYhuGsGueCuVSsiWm/5P6EsuLzECc9WgoXmvb7EF2noMTAvJRxqIXAa4S1LhNd+08HtU4MTRRM5rgXUkeGZf6CZZmbC6An9oNBxS3775QjKmSMJCqQEUIm7ZFH7n05xUKTtLPe2Lxhaqji2v/xGAGpy1/tYJS+d6bVwVOxjjOPN/DquAGF'
      ALGOLIA_INDEX: 'AgAnkRMw/cxDTGHlVqgWw6E/d0Qg85BGIOP6Np+pBCnl0ROcVYorBOBOeKX1dBWmR2A/aaaiDhUUgSPFW9rCn7PabxGJq7806/QNAvnZLXLp93luKkLDXRfF+h3GKWFR812oR4S8E6eg7Y+w83m7cUXWnYoz3kHzlwBxQScTLtgB4TFRL4Edp3G4OZFhe6I+RDsEWSLUWSKDYMwT+0uzs6xMSwTsrhUpaF4yjVgM5c9/yvoHZb17+uGamRSz2KllBF0H62AXVZX/bubC6QjhmffmPO62C9E904KiUAsUae9icEanaH1obVADsK+F+BKqaSV5tUAQ+3w5G4ctRpyup7TKxrOHy+O49JOriMOANk1i1jhkPcPwksAkaSXDY9F3KxeeN0qOsw3Pxtmue/AAUecX/lbzE3k8RMRZAEAIIA46gWDQJnCLV7IYWHnCWROON+Xmstor1gvw0hHKgBydPG+h5uz0Dt8xGUsipa9xNqdH2LmW5kX7W6/tE7oX0kDrlV5C6Kn/69Ip/RfsKtUrYs0qcfdcJkbjHWDB5WxNWxo4L5wxxloRIlAyB9/bjx0ra6QeTKWiZoDCZ3xi8N1wfgbBrHlKLE0K4O4Kd1kTL4HoUC0GcH8JrOxyUWAMXUQCrbFk2HOgVdsfhTeLn3g2e0oAQolPEtXeT/3UQzjSKcTeRycn5yYVobCI1Rs/Z4i7NnISeAdpqa4u'
      ALGOLIA_KEY: 'AgAG7rUp7mYLqfVrZsni0tSyMlqarGiMex9vcTO4uHJmTEObgFWIVwRBHfbVxgsyaenKkPnHg0zLp+JcRwJIssg1ahci3wX36IntvYPQXcuAQY4sXbo+6lSZ+iq1wSk9X8xr3ySfrEcyXoLCPuMJmy7ehZIfHS4ua+vr3t5nLROpe9rpSbrht3dcrni+9IfeS6qngi542R0VihJLGuIX5dnaAQY9ZU6ITLxy7FDO7YHS2extarWjsLmp9dkgGSes5XQdbaO9r92Fy3ZafRDevJyLhtYWP9NB+9sdR6Q5c+rJygq9FA78AsL/buAZWxklOc3PI5BRPalgwfjr1yRaa3hJqmWOGP+kSlmzG4e8VHgr1HbvCKhtksHM0yi1/yNf58ClAdqBXax1TZfAOKufxIoWj+2SSEeQIpiYA9HkzrGlLbVOfIy9Vy61QzwdWomGxsSZvQ7uR01xU1RkZKDy4XILMPTofdm9L6zuYasFs1tDtkQp0UFBm+XNsUzNQioV8FdwXJEpd+/R5Ws46/D2nvu27aqgK6e9b++YRBBXg2Pz/y+E7nuhuIL+NSGxwb/E6/yO0HSxqGZe0V71o8las/FHewUffKG2epq+rYnQF3tFgIEP3OMFuV0mLjVldaj1uCErNNSxo151JWVUf+Id3awvUP611wjA29uova1jYeD1NVHX1QLAvRtHSmJY8tEffpuBVE7kd/v6NF+egbDibk0I2XsG20kP46qr0tZ66PKsrA=='
    ingress:
      enabled: true
      hosts:
        - l3miage.fr
        - www.l3miage.fr
        - genie.l3miage.fr
      redirect:
        regex: ^https?://(?:www|genie).l3miage.fr(.*)
        replacement: https://l3miage.fr${1}
    canary:
      enabled: true
      url: https://l3miage.fr
    pprof:
      enabled: true
